# 小说标注工具 - 产品需求文档 (PRD)

## 1. 概述

小说标注工具是一款为小说创作者、编辑和分析师设计的专业级内容分析与管理平台。它旨在通过强大而灵活的标签系统与剧情线追踪功能，帮助用户对小说文本进行深度、多维度的结构化分析。用户可以管理小说项目，并在一个统一、高效的交互视图中，无缝地完成文本修正、内容标注和剧情脉络梳理，从而提升创作效率和作品质量。

## 2. 用户角色

本工具主要服务于单一用户角色：

*   **小说作者/分析师**：使用本工具进行小说内容的创作、编辑、管理和深度分析。

## 3. 核心设计理念：统一分析视图

为了提供极致流畅的工作体验，本工具摒弃了传统的“编辑框”与“预览框”分离的模式，采用**统一分析视图 (Unified Analysis View)** 作为核心交互界面。

*   **所见即所得**：中栏的内容面板始终以最终渲染的形态展示，包含了文本、高亮和各种标记。用户直接与最终稿交互。
*   **情境化操作**：所有操作（文本编辑、创建标注、放置锚点）都在用户当前关注点就近触发，无需在不同区域间大幅移动视线和鼠标。

### 3.1 统一视图下的核心交互

在统一分析视图中，用户可以随时进行以下三类操作，无论当前处于何种分析模式：

#### 3.1.1 内联文本编辑 (Inline Text Editing)
- **触发方式**：用户直接**双击**任意一个文本段落。
- **响应**：该段落会**原地**转换为一个小型编辑框，允许用户修改错别字、调整语序等。此时，视图中的其他内容（包括其他段落、高亮、标记）保持不变。
- **保存**：用户在编辑框外点击，修改内容即自动保存。系统后台会同步更新小说原文，并智能地重新对齐所有关联的元数据（标注、锚点）的位置。

#### 3.1.2 创建标注 (Creating Annotations)
- **触发方式**：用户用鼠标划选任意一段文本。
- **响应**：划选操作结束后，一个**上下文菜单 (Context Menu)** 会立即浮现在所选文本旁边。
- **操作**：用户可通过此菜单快速将选中的文本创建为一个“待定标注”，或直接应用一个具体的标签。

#### 3.1.3 放置剧情锚点 (Placing Plot Anchors)
- **触发方式**：用户的鼠标在段落之间或行尾悬停。
- **响应**：一个**悬浮按钮** (如 `+` 或 `⚓︎`) 会动态地出现在该位置。
- **操作**：用户点击该按钮，即可在该精确位置插入一个“剧情锚点”，并从弹出的菜单中为其关联一条或多条“故事线”。

## 4. 分析模式切换

为了让用户能专注于特定任务，统一分析视图提供了三种“分析模式”。切换模式并不会改变核心的统一视图，而是**切换当前启用的“工具集”和侧边栏面板**。

### 4.1 写作模式 (Writing Mode)
- **核心焦点**：纯粹的文本内容修正与创作。
- **视图状态**：
    - **中栏**：界面最纯净，可能默认不显示任何高亮和锚点标记，以减少干扰。核心的“内联文本编辑”功能完备可用。
    - **侧边栏**：显示章节列表等基础面板，或最小化。

### 4.2 标注模式 (Annotation Mode)
- **核心焦点**：文本**范围**与**标签**的精细化管理。
- **视图状态**：
    - **中栏**：加载“标注工具集”，激活“划词出菜单”功能，并渲染所有与标签相关的文本高亮。
    - **左栏**：显示“标签管理面板”。
    - **右栏**：显示“筛选结果面板”。

### 4.3 剧情线模式 (Storyline Mode)
- **核心焦点**：宏观剧情脉络的梳理，处理剧情**位置**。
- **视图状态**：
    - **中栏**：加载“剧情线工具集”，激活“悬浮插入锚点”功能，并渲染所有剧情锚点的视觉标记。
    - **左栏**：显示全新的“故事线管理面板”。
    - **右栏**：显示“故事线追踪器”面板。

## 5. 核心功能详述

### 5.1 项目与用户管理
- **用户认证**：提供用户注册、登录、登出功能。首次登录会自动加载演示项目。
- **项目管理**：提供小说项目的创建（可选用标签模板）、上传（.txt文件）、删除功能。

### 5.2 标签模板管理
- 提供独立的模态框用于管理不同题材的标签模板。
- 用户可以对模板及其内部的标签层级进行增、删、改、拖拽排序等操作。

### 5.3 自动分章
- 在上传小说或编辑全文时，系统会根据预设规则（如 `第X章`）自动切分章节。
- 分章结果展示在侧边栏的“章节列表”视图中。

### 5.4 标签与标注系统 (标注模式)
- **标签管理**：在左栏进行标签的创建、颜色/名称修改、层级拖拽等。
- **创建标注**：通过中栏的“划词出菜单”功能实现。标注会自动按段落（换行符）拆分。
- **查看与筛选**：
    - 中栏通过不同颜色的高亮实时展示标注。高亮颜色取决于层级最深的标签。
    - 右栏展示筛选后的标注列表。点击左栏的标签可筛选该标签及其所有子标签的标注。

### 5.5 剧情锚点与故事线 (剧情线模式)
- **故事线 (Storyline)**：
    - 定义：一个宏观的、有名字的叙事线索（如“主线-问道宗考验”）。
    - 管理：在左栏的“故事线管理面板”中创建、重命名、删除故事线，并为其指定颜色。
- **剧情锚点 (Plot Anchor)**：
    - 定义：在小说正文编辑器中插入的一个**位置标记**，代表某条或多条故事线在此处发生进展。
    - 非侵入性：锚点是元数据，不属于小说原文，仅在编辑器中渲染。
- **工作流程**：
    1.  在左栏定义好所有“故事线”。
    2.  在中栏通过“悬浮插入”功能在文本的精确位置放置“剧情锚点”。
    3.  为锚点关联一条或多条“故事线”。
    4.  在右栏的“故事线追踪器”中，点击某条故事线，即可在列表中看到所有相关锚点，并可在中栏快速跳转、回顾剧情脉络。

### 5.6 全局搜索
- 提供跨所有小说项目的标签搜索功能。
- 搜索结果页清晰展示标注原文、来源小说（可跳转）及关联标签。

## 6. 非功能性需求
- **易用性**：界面直观，核心操作高效。
- **响应性**：界面能适应不同屏幕尺寸。
- **数据持久性**：用户数据在浏览器会话期间保持一致。